<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>至尊影院 - 沉浸式播放</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500;700&family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           1. 核心配色 (与 Login.html 保持一致)
           ========================================= */
        :root {
            --bg-body: #050505;
            --primary: #d4af37;
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --glass-bg: rgba(20, 20, 20, 0.85); 
            --border-color: rgba(212, 175, 55, 0.3);
        }

        ::-webkit-scrollbar { width: 0; height: 0; background: transparent; }
        html, body { scrollbar-width: none; -ms-overflow-style: none; }

        body {
            -webkit-user-select: none; user-select: none;
            font-family: 'Noto Sans SC', sans-serif;
            color: #fff; height: 100vh; overflow: hidden;
            margin: 0; padding: 0;
            background-color: var(--bg-body);
        }

        /* =========================================
           2. 影院容器
           ========================================= */
        .cinema-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; background: #000;
        }

        .cinema-vignette {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            box-shadow: inset 0 0 150px rgba(0,0,0,0.95);
            pointer-events: none; z-index: 10;
        }

        #videoPlayer {
            width: 100%; height: 100%; border: none;
            position: absolute; top: 0; left: 0; z-index: 5;
            display: none;
        }

        .video-placeholder {
            width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: radial-gradient(circle at center, #141414 0%, #000 100%);
            z-index: 2;
            color: #444;
        }

        /* =========================================
           3. 左侧自动隐藏线路列表
           ========================================= */
        .drawer-trigger {
            position: fixed; top: 50%; left: 0;
            transform: translateY(-50%);
            width: 36px; height: 100px; /* 更加小巧 */
            background: rgba(15, 15, 15, 0.9);
            border: 1px solid var(--border-color);
            border-left: none;
            border-radius: 0 8px 8px 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; z-index: 2000;
            transition: all 0.3s ease;
            box-shadow: 2px 0 15px rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .drawer-trigger:hover {
            background: #222; border-color: var(--primary);
        }

        .drawer-trigger.hidden {
            left: -50px; opacity: 0; pointer-events: none;
        }

        .trigger-icon {
            color: var(--primary); font-size: 0.9rem; margin-bottom: 5px;
            animation: pulse 2s infinite;
        }

        .trigger-text {
            writing-mode: vertical-rl; text-orientation: upright;
            color: #ccc; font-size: 0.75rem; letter-spacing: 2px; font-weight: bold;
        }

        /* 紧凑型悬浮列表 */
        .left-drawer {
            position: fixed; top: 50%; left: -240px; transform: translateY(-50%);
            width: 200px; height: auto;
            background: var(--glass-bg);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-left: none; border-radius: 0 10px 10px 0;
            z-index: 3000;
            transition: left 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.3s;
            display: flex; flex-direction: column;
            box-shadow: 5px 0 30px rgba(0,0,0,0.8);
            opacity: 0; padding: 12px 8px;
        }

        .left-drawer.active { left: 0; opacity: 1; }

        .drawer-title {
            text-align: center; color: var(--primary); 
            font-family: 'Noto Serif SC', serif; font-size: 0.95rem;
            margin-bottom: 10px; padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .line-list { list-style: none; padding: 0; margin: 0; }
        
        .line-item {
            padding: 9px 5px; margin-bottom: 5px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 6px; cursor: pointer;
            font-size: 0.8rem; color: #aaa; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }

        .line-item:hover {
            background: rgba(212, 175, 55, 0.15); color: #fff; border-color: rgba(212, 175, 55, 0.4);
        }

        .line-item.active {
            background: var(--gold-gradient); color: #000; font-weight: bold; border: none;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        /* =========================================
           4. 美化版检测弹窗 (完全复刻 Login.html 风格)
           ========================================= */
        .check-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); /* 稍微调暗背景 */
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.6s ease, visibility 0.6s;
            backdrop-filter: blur(5px);
        }

        /* 核心修改：复刻 .login-wrapper 样式 */
        .check-box {
            width: 340px; /* 宽度缩窄 */
            padding: 25px 30px; /* 内边距减小 (高度缩减关键) */
            
            background: var(--glass-bg); /* 统一磨砂背景 */
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.9);
            
            position: relative; overflow: hidden;
            text-align: center;
            transform: translateY(0);
            animation: fadeInUp 0.5s ease-out;
        }

        /* 顶部金线 */
        .check-box::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: var(--gold-gradient); opacity: 0.9;
        }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .check-icon {
            font-size: 2.2rem; /* 图标缩小 */
            margin-bottom: 12px;
            background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(212, 175, 55, 0.15);
        }

        .check-title {
            font-family: 'Noto Serif SC', serif; font-size: 1.3rem; margin-bottom: 20px;
            color: #fff; letter-spacing: 1px;
        }

        /* 紧凑的信息行 */
        .info-group {
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            padding: 10px 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .info-row {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.9rem; padding: 4px 0;
        }
        
        .info-label { color: #888; }
        .info-value { color: var(--primary); font-family: 'Noto Sans SC', monospace; font-weight: 500; }

        .status-text {
            font-size: 0.85rem; color: #666; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        
        /* 紧凑的退出按钮 */
        .logout-link {
            font-size: 0.8rem; color: #555; cursor: pointer; text-decoration: none;
            transition: 0.3s; display: inline-block; padding: 5px 10px;
            border-radius: 4px;
        }
        .logout-link:hover { color: #fff; background: rgba(255,255,255,0.05); }

    </style>
    <script>
        let currentUser = null;
        
        const vipLines = [
            { name: "超级会员一号线", url: "https://jx.xmflv.com/?url=" },
            { name: "超级会员二号线", url: "https://jx.789jiexi.com/?url=" },
            { name: "超级会员三号线", url: "https://im1907.top/?jx=" },
            { name: "超级会员四号线", url: "https://jx.m3u8.tv/jiexi/?url=" },
            { name: "超级会员五号线", url: "https://jx.playerjy.com/?url=" },
            { name: "超级会员六号线", url: "https://www.ckplayer.vip/jiexi/?url=" },
            { name: "超级会员七号线", url: "https://jx.yparse.com/index.php?url=" },
            { name: "超级会员八号线", url: "https://www.8090g.cn/?url=" }
        ];

        function initApp() {
            const userStr = localStorage.getItem('vip_user');
            if (!userStr) {
                window.location.href = 'login.html';
                return;
            }
            currentUser = JSON.parse(userStr);
            
            window.addEventListener('DOMContentLoaded', () => {
                renderLineList();
                runSecurityCheck();
                bindDrawerInteraction();
            });
        }

        function renderLineList() {
            const listContainer = document.getElementById('lineListContainer');
            if(!listContainer) return;
            listContainer.innerHTML = '';
            
            vipLines.forEach((line, index) => {
                const li = document.createElement('li');
                li.className = 'line-item' + (index === 0 ? ' active' : '');
                li.innerHTML = `<i class="fas fa-play" style="font-size:0.6rem;"></i> ${line.name}`;
                li.onclick = () => switchLine(line.url, li);
                listContainer.appendChild(li);
            });
        }

        function bindDrawerInteraction() {
            const trigger = document.getElementById('drawerTrigger');
            const drawer = document.getElementById('leftDrawer');

            trigger.addEventListener('click', () => {
                drawer.classList.add('active');
                trigger.classList.add('hidden');
            });

            drawer.addEventListener('mouseleave', () => {
                closeDrawer();
            });
        }

        function closeDrawer() {
            document.getElementById('leftDrawer').classList.remove('active');
            document.getElementById('drawerTrigger').classList.remove('hidden');
        }

        function switchLine(apiUrl, element) {
            document.querySelectorAll('.line-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            closeDrawer();

            const urlParams = new URLSearchParams(window.location.search);
            const vUrl = urlParams.get('v_url');
            if(vUrl) {
                playVideo(apiUrl, vUrl);
            } else {
                alert('请先添加视频地址');
            }
        }

        function runSecurityCheck() {
            const checkModal = document.getElementById('checkModal');
            const statusText = document.getElementById('statusText');
            
            if(currentUser) {
                document.getElementById('displayLevel').innerText = isPermanentVip(currentUser.expire_time) ? 'SVIP 尊享会员' : 'VIP 会员';
                document.getElementById('displayAccount').innerText = maskUsername(currentUser.username);
            }

            setTimeout(() => { statusText.innerHTML = '<i class="fas fa-satellite-dish"></i> 正在建立加密通道...'; }, 600);
            
            setTimeout(() => {
                statusText.innerHTML = '<i class="fas fa-check"></i> 验证通过，准备播放';
                statusText.style.color = '#4CAF50';
            }, 1500);

            setTimeout(() => {
                checkModal.style.opacity = '0';
                checkModal.style.visibility = 'hidden';
                
                const urlParams = new URLSearchParams(window.location.search);
                const vUrl = urlParams.get('v_url');
                
                if(vUrl) {
                    playVideo(vipLines[0].url, vUrl);
                } else {
                    const placeholder = document.getElementById('placeholder');
                    if(placeholder) {
                        placeholder.innerHTML = `
                            <i class="fas fa-film" style="font-size:2.5rem; margin-bottom:15px; opacity:0.7"></i>
                            <p style="font-size:0.9rem; color:#666;">等待视频信号...</p>
                        `;
                    }
                }
            }, 2200);
        }

        function playVideo(api, vUrl) {
            const player = document.getElementById('videoPlayer');
            const placeholder = document.getElementById('placeholder');
            if(player && placeholder) {
                placeholder.style.display = 'none';
                player.style.display = 'block';
                player.src = api + vUrl;
            }
        }

        function logout() {
            if(confirm('确定要退出当前账号吗？')) {
                localStorage.removeItem('vip_user');
                window.location.href = 'login.html';
            }
        }

        function maskUsername(username) {
            const str = String(username || '');
            if (/^\d{11}$/.test(str)) return str.replace(/^(\d{3})\d{4}(\d{4})$/, '$1****$2');
            return str.length > 4 ? str.substring(0, 2) + "****" + str.substring(str.length - 2) : "****";
        }

        function isPermanentVip(expireTime) {
            if (!expireTime) return false;
            return (new Date(expireTime).getTime() - Date.now()) > 315360000000; 
        }

        initApp();
    </script>
</head>
<body>

    <!-- 1. 优化版检测弹窗 (Login.html 风格) -->
    <div id="checkModal" class="check-modal">
        <div class="check-box">
            <!-- 顶部图标 -->
            <div class="check-icon"><i class="fas fa-crown"></i></div>
            
            <!-- 标题 -->
            <div class="check-title">至尊会员通道</div>
            
            <!-- 信息聚合块 -->
            <div class="info-group">
                <div class="info-row">
                    <span class="info-label">身份</span>
                    <span class="info-value" id="displayLevel">检测中...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">账号</span>
                    <span class="info-value" id="displayAccount">****</span>
                </div>
            </div>

            <!-- 状态文字 -->
            <div class="status-text" id="statusText">
                <i class="fas fa-circle-notch fa-spin"></i> 权限校验中...
            </div>
            
            <!-- 底部退出 -->
            <a class="logout-link" onclick="logout()">
                切换账号 <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </div>

    <!-- 2. 全屏播放容器 -->
    <div class="cinema-container">
        
        <!-- 3. 左侧触发按钮 -->
        <div class="drawer-trigger" id="drawerTrigger">
            <i class="fas fa-exchange-alt trigger-icon"></i>
            <span class="trigger-text">换线</span>
        </div>

        <!-- 4. 紧凑型自动隐藏线路列表 -->
        <div class="left-drawer" id="leftDrawer">
            <div class="drawer-title">VIP 专线</div>
            <ul class="line-list" id="lineListContainer">
                <!-- JS填充 -->
            </ul>
        </div>

        <!-- 影院遮罩 -->
        <div class="cinema-vignette"></div>

        <!-- 占位符/播放器 -->
        <div class="video-placeholder" id="placeholder"></div>
        <iframe id="videoPlayer" allowfullscreen allow="autoplay; encrypted-media"></iframe>
    </div>

</body>
</html>

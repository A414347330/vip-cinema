<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>VIP 影院 - 沉浸观影</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { background: #000; color: #fff; font-family: sans-serif; margin: 0; }
    .navbar { padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    .gold { color: #e0c388; }
    .content { padding: 50px; text-align: center; }
    .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; padding: 20px; }
    .movie-card { background: #1a1a1a; height: 300px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #555; border: 1px solid #333; }
    
    /* 激活弹窗遮罩 */
    #activateModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 999; display: none; flex-direction: column; justify-content: center; align-items: center; }
    .modal-box { background: #1a1a1a; padding: 40px; border: 1px solid #e0c388; border-radius: 10px; text-align: center; width: 300px; }
    input { padding: 10px; width: 80%; margin: 15px 0; background: #000; border: 1px solid #444; color: #fff; }
    button { padding: 10px 20px; background: #e0c388; border: none; font-weight: bold; cursor: pointer; }
</style>
</head>
<body>

    <div class="navbar">
        <div class="gold"><i class="fas fa-film"></i> SVIP CINEMA</div>
        <div id="userInfo"></div>
    </div>

    <div class="content">
        <h1>欢迎尊贵的 VIP 会员</h1>
        <p>这里是只有激活会员才能看到的 4K 资源库</p>
        <div class="movie-grid">
            <div class="movie-card">4K 独家资源 01</div>
            <div class="movie-card">4K 独家资源 02</div>
            <div class="movie-card">4K 独家资源 03</div>
            <div class="movie-card">4K 独家资源 04</div>
        </div>
    </div>

    <!-- 强制激活弹窗 -->
    <div id="activateModal">
        <div class="modal-box">
            <h2 class="gold"><i class="fas fa-lock"></i> 账号未激活</h2>
            <p style="color:#aaa; font-size:0.9rem;">请输入您的 VIP 激活码以解锁全部内容</p>
            <input type="text" id="code" placeholder="VIP-XXXX-XXXX">
            <button onclick="activate()">立即激活</button>
            <p style="margin-top:20px; font-size:0.8rem; color:#666;">请联系管理员购买激活码</p>
            <button onclick="logout()" style="background:transparent; color:#666; font-weight:normal; font-size:0.8rem;">退出登录</button>
        </div>
    </div>

    <script>
        // 1. 检查登录状态
        const userStr = localStorage.getItem('vip_user');
        if(!userStr) {
            window.location.href = 'login.html'; // 没登录直接踢走
        }

        const user = JSON.parse(userStr);
        document.getElementById('userInfo').innerHTML = `Hi, ${user.username} <a href="#" onclick="logout()" style="color:#666; font-size:0.8rem; margin-left:10px;">[退出]</a>`;

        // 2. 检查激活状态
        if(user.is_active !== 1) {
            document.getElementById('activateModal').style.display = 'flex';
        }

        // 3. 激活逻辑
        async function activate() {
            const code = document.getElementById('code').value;
            if(!code) return alert('请输入激活码');

            const res = await fetch('/api/activate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ username: user.username, code })
            });
            const data = await res.json();
            if(data.success) {
                alert('激活成功！欢迎入驻');
                // 更新本地状态
                user.is_active = 1;
                localStorage.setItem('vip_user', JSON.stringify(user));
                location.reload();
            } else {
                alert(data.message);
            }
        }

        function logout() {
            localStorage.removeItem('vip_user');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>